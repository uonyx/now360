//
//  cx_string.c
//
//  Created by Ubaka Onyechi on 01/07/2012.
//  Copyright (c) 2012 uonyechi.com. All rights reserved.
//

#include "cx_string.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxi32 cx_str_html_unescape (char *dst, cxu32 dstSize, const char *src)
{
  CX_ASSERT (src);
  CX_ASSERT (dst);
  CX_ASSERT (dstSize);
  
  const char *s = src;
  cxu32 len = 0;
  char ch = 0;
  
  while ((ch = *s))
  {
    if (ch == '&')
    {
      if ((s [1] == 'q') && (s [2] == 'u') && (s [3] == 'o') && (s [4] == 't') && (s [5] == ';')) // &quot
      {
        s += 6;
        ch = '\"';
      }
      else if ((s [1] == 'a') && (s [2] == 'p') && (s [3] == 'o') && (s [4] == 's') && (s [5] == ';')) // &apos
      {
        s += 6;
        ch = '\'';
      }
      else if ((s [1] == 'a') && (s [2] == 'm') && (s [3] == 'p') && (s [4] == ';')) // &amp
      {
        s += 5;
        ch = '&';
      }
      else if ((s [1] == 'g') && (s [2] == 't') && (s [3] == ';')) // &gt
      {
        s += 4;
        ch = '>';
      }
      else if ((s [1] == 'l') && (s [2] == 't') && (s [3] == ';')) // &lt
      {
        s += 4;
        ch = '<';
      }
      else 
      {
        s++;
      }
    }
    else 
    {
      s++;
    }
    
    CX_ASSERT (len < dstSize);
    dst [len++] = ch;
  }
  
  CX_ASSERT (len < dstSize);
  dst [len] = 0;
  
  return len;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

