//
//  cx_file.c
//
//  Created by Ubaka Onyechi on 02/01/2012.
//  Copyright (c) 2012 uonyechi.com. All rights reserved.
//

#include "cx_file.h"
#include "cx_native_ios.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cx_file_open (cx_file *file, const char *filename, cxu32 mode)
{
  CX_ASSERT (file);
  CX_ASSERT (filename);
  CX_ASSERT ((mode >= 0) && (mode < CX_FILE_NUM_MODES));
  
  static const char *modes [CX_FILE_NUM_MODES] = 
  {
    "rb",
    "wb",
    "ab",
  };
  
  const char *m = modes [mode];
  
  char fullFilePath [512];
  
  cx_native_file_get_path_from_resource (filename, fullFilePath, 512);

  *file = fopen (fullFilePath, m);

  return (file != NULL);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cx_file_close (cx_file *file)
{
  int err = fclose (*file);
  
  *file = NULL;
  
  return (err == 0);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxu32 cx_file_read (cx_file *file, void *buffer, cxu32 size, cxu32 count)
{
  CX_ASSERT (file);
  
  return fread (buffer, size, count, *file);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxu32 cx_file_write (cx_file *file, void *buffer, cxu32 size, cxu32 count)
{
  CX_ASSERT (file);
  
  return fwrite (buffer, size, count, *file);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxi32 cx_file_flush (cx_file *file)
{
  CX_ASSERT (file);
  
  return fflush (*file);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxi32 cx_file_seek (cx_file *file, cxi32 offset, cxi32 origin)
{
  CX_ASSERT (file);
  
  return fseek (*file, offset, origin);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cxu32 cx_file_size (cx_file *file)
{
  CX_ASSERT (file);
  
  fseek (*file, 0L, SEEK_END);
  
  cxu32 size = (cxu32) ftell (*file);
  
  fseek (*file, 0L, SEEK_SET);
  
  return size;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cx_file_exists (const char *filename)
{
  CX_ASSERT (filename);
  
  bool exists = false;
  
  FILE *fp = fopen (filename, "rb");
  
  if (fp)
  {
    fclose (fp);
    
    exists = true;
  }
  
  return exists;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_file_absolute_path (const char *filename, char *destFilepath, int destFilePathSize)
{
  CX_ASSERT (filename);
  CX_ASSERT (destFilepath);
  CX_ASSERT (destFilePathSize > 0);
  
  cx_native_file_get_path_from_resource (filename, destFilepath, destFilePathSize);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
