//
//  cx_thread.c
//
//  Created by Ubaka Onyechi on 17/06/2012.
//  Copyright (c) 2012 uonyechi.com. All rights reserved.
//

#include "cx_thread.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

static void *cx_thread_pthread_func (void *data)
{
  CX_ASSERT (data);
  
  cx_thread *thread = (cx_thread *) data;
  
  if (thread->func)
  {
    thread->func (thread->userdata);
  }
  
  pthread_exit (NULL);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

cx_thread *cx_thread_create (const char *name, cx_thread_func func, void *userdata)
{
  cx_thread *thread = cx_malloc (sizeof (cx_thread));
  
  thread->func = func;
  thread->userdata = userdata;
  
  int ret = pthread_create (&thread->id, NULL, cx_thread_pthread_func, thread);
  
  if (ret != 0)
  {
    cx_free (thread);
    thread = NULL;
  }
  
  return thread;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_destroy (cx_thread *thread)
{
  CX_ASSERT (thread);
  
  cx_free (thread);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_mutex_init (cx_thread_mutex *mutex)
{
  CX_ASSERT (mutex);
  
  //*mutex = PTHREAD_MUTEX_INITIALIZER;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_mutex_deinit (cx_thread_mutex *mutex)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_mutex_lock (cx_thread_mutex *mutex)
{
  pthread_mutex_lock (mutex);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_mutex_unlock (cx_thread_mutex *mutex)
{
  pthread_mutex_unlock (mutex);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_event_init (cx_thread_event *event)
{
  //event->event = PTHREAD_COND_INITIALIZER;
  //event->mutex = PTHREAD_MUTEX_INITIALIZER;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_event_deinit (cx_thread_event *event)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cx_thread_event_wait (cx_thread_event *event, cxi32 timeout)
{
  return 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void cx_thread_event_signal (cx_thread_event *event)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
