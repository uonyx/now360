//
//  network.h
//  earthnews
//
//  Created by Ubaka Onyechi on 01/05/2012.
//  Copyright (c) 2012 uonyechi.com. All rights reserved.
//

#ifndef EARTHNEWS_NETWORK_H
#define EARTHNEWS_NETWORK_H

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

#define HTTP_MAX_HEADER_FIELD_NAME_BUFFER   32
#define HTTP_MAX_HEADER_FIELD_VALUE_BUFFER  96

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef enum http_conn
{
  HTTP_CONNECTION_OK,
  HTTP_CONNECTION_ERROR,
} http_conn;

#define HTTP_TRANSACTION_ID_INVALID 0xffffffff
typedef unsigned int http_transaction_id;

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct http_request_field
{
  const char *name;
  const char *value;
} http_request_field;

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct http_response
{
  http_conn error;
  int statusCode;
  const void *data;
  int dataSize;
} http_response;

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct http_request
{
  const char *url;
  http_request_field *headers;
  unsigned int headerCount;
  unsigned int timeout;
  
  void *nsconn;
  
} http_request;

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef void (*http_response_callback) (http_transaction_id tId, const http_response *response, void *userdata);

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

void http_init (void);
void http_deinit (void);
void http_percent_encode (const char *dest, const char *src);
http_transaction_id http_get (const char *url, http_request_field *headers, int headerCount, int timeout, http_response_callback callback, void *userdata);
http_transaction_id http_post (const char *url, const void *postdata, int postdataSize, http_request_field *headers, int headerCount, int timeout, http_response_callback callback, void *userdata);

////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////

#endif
